{
  "version": "https://jsonfeed.org/version/1.1",
  "title": "jcsherin",
  "language": "en",
  "home_page_url": "https://jacobsherin.com/",
  "feed_url": "https://example.com/feed/feed.json",
  "description": "jcsherin writes about programming",
  "author": {
    "name": "Your Name Here",
    "url": "https://example.com/about-me/"
  },
  "items": [{
      "id": "https://jacobsherin.com/posts/dremel-column-striping/",
      "url": "https://jacobsherin.com/posts/dremel-column-striping/",
      "title": "Nested Record Shredding",
      "content_html": "<h1 id=\"summary\" tabindex=\"-1\">Summary <a class=\"direct-link\" href=\"https://jacobsherin.com/posts/dremel-column-striping/#summary\" aria-hidden=\"true\">#</a></h1>\n<ul>\n<li>[ ] Condense main ideas, supporting arguments, opinions, recap</li>\n</ul>\n<h1 id=\"nested-data-structure\" tabindex=\"-1\">Nested Data Structure <a class=\"direct-link\" href=\"https://jacobsherin.com/posts/dremel-column-striping/#nested-data-structure\" aria-hidden=\"true\">#</a></h1>\n<pre><code>+-----------------+\n| ProductImages   |\n+-----------------+\n├── [ product_id ]: 103\n├── [ images ]\n│   ├── [ primary_id ]: 4400\n│   └── [ secondary_image_ids ]\n│       ├── [0]: 4401\n│       ├── [1]: 4402\n│       └── [2]: 4403\n└── [ alt_text ]\n    └── [ localizations ]\n        ├── [0]\n        │   ├── [ locale ]: &quot;en-us&quot;\n        │   ├── [ description ]: &quot;red running shoe, side view.&quot;\n        │   └── [ keywords ]\n        │       ├── [0]: &quot;red shoe&quot;\n        │       ├── [1]: &quot;running&quot;\n        │       └── [2]: &quot;sport&quot;\n        ├── [1]\n        │   ├── [ locale ]: &quot;en-au&quot;\n        │   └── [ keywords ]\n        │       ├── [0]: &quot;red runner&quot;\n        │       └── [1]: &quot;jogging&quot;\n        └── [2]\n            ├── [ locale ]: &quot;en-gb&quot;\n            ├── [ description ]: &quot;red trainer, profile.&quot;\n            └── [ keywords ]\n                ├── [0]: &quot;trainer&quot;\n                └── [1]: &quot;athletics&quot;\n</code></pre>\n<p>Column shredding (aka record shredding) is a technique for flattening deeply\nnested data structures and storing them in a columnar format.</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">Identifier</th>\n<th style=\"text-align:left\">Full Field Path</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">product_id</td>\n<td style=\"text-align:left\">product_id</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">primary_id</td>\n<td style=\"text-align:left\">images.primary_id</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">secondary_image_ids</td>\n<td style=\"text-align:left\">images.secondary_image_ids</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">locale</td>\n<td style=\"text-align:left\">alt_text.localizations.locale</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">description</td>\n<td style=\"text-align:left\">alt_text.localizations.description</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">keywords</td>\n<td style=\"text-align:left\">alt_text.localizations.keywords</td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">product_id</th>\n<th style=\"text-align:left\">primary_id</th>\n<th style=\"text-align:left\">secondary_image_ids</th>\n<th style=\"text-align:left\">locale</th>\n<th style=\"text-align:left\">description</th>\n<th style=\"text-align:left\">keywords</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">103</td>\n<td style=\"text-align:left\">4400</td>\n<td style=\"text-align:left\">4401</td>\n<td style=\"text-align:left\">&quot;en-us&quot;</td>\n<td style=\"text-align:left\">&quot;red running shoe...&quot;</td>\n<td style=\"text-align:left\">[&quot;red shoe&quot;, &quot;running&quot;, &quot;sport&quot;]</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\">4402</td>\n<td style=\"text-align:left\">&quot;en-au&quot;</td>\n<td style=\"text-align:left\">NULL</td>\n<td style=\"text-align:left\">[&quot;red runner&quot;, &quot;jogging&quot;]</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\">4403</td>\n<td style=\"text-align:left\">&quot;en-gb&quot;</td>\n<td style=\"text-align:left\">&quot;red trainer, pr...&quot;</td>\n<td style=\"text-align:left\">[&quot;trainer&quot;, &quot;athletics&quot;]</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"introduction\" tabindex=\"-1\">Introduction <a class=\"direct-link\" href=\"https://jacobsherin.com/posts/dremel-column-striping/#introduction\" aria-hidden=\"true\">#</a></h1>\n<p>The main issue with flattening nested data structures is ensuring the\nprocess is reversible. The flattened representation needs to contain both data\nand the metadata which encodes the structure. From this representation, one\nshould be able to correctly reconstruct the original nested data structure.</p>\n<p>Typically, a query reads only a few attributes. Therefore, it is more\nefficient to read only those specific attributes, rather than the entire\nnested data structure. Consequently, a core desirable property of\nsuch flattening is the ability to partially reconstruct the nested data\nstructure, skipping any attributes not mentioned in the query.</p>\n<h1 id=\"nested-data-structure-1\" tabindex=\"-1\">Nested Data Structure <a class=\"direct-link\" href=\"https://jacobsherin.com/posts/dremel-column-striping/#nested-data-structure-1\" aria-hidden=\"true\">#</a></h1>\n<pre><code>+-----------------+\n| ProductImages   |\n+-----------------+\n├── [ product_id ]: 103\n├── [ images ]\n│   ├── [ primary_id ]: 4400\n│   └── [ secondary_image_ids ]\n│       ├── [0]: 4401\n│       ├── [1]: 4402\n│       └── [2]: 4403\n└── [ alt_text ]\n    └── [ localizations ]\n        ├── [0]\n        │   ├── [ locale ]: &quot;en-us&quot;\n        │   ├── [ description ]: &quot;red running shoe, side view.&quot;\n        │   └── [ keywords ]\n        │       ├── [0]: &quot;red shoe&quot;\n        │       ├── [1]: &quot;running&quot;\n        │       └── [2]: &quot;sport&quot;\n        ├── [1]\n        │   ├── [ locale ]: &quot;en-au&quot;\n        │   └── [ keywords ]\n        │       ├── [0]: &quot;red runner&quot;\n        │       └── [1]: &quot;jogging&quot;\n        └── [2]\n            ├── [ locale ]: &quot;en-gb&quot;\n            ├── [ description ]: &quot;red trainer, profile.&quot;\n            └── [ keywords ]\n                ├── [0]: &quot;trainer&quot;\n                └── [1]: &quot;athletics&quot;\n</code></pre>\n<h2 id=\"productimages:-illustrative-partial-projections\" tabindex=\"-1\">ProductImages: Illustrative Partial Projections <a class=\"direct-link\" href=\"https://jacobsherin.com/posts/dremel-column-striping/#productimages:-illustrative-partial-projections\" aria-hidden=\"true\">#</a></h2>\n<pre><code>ProductImages_AltText\n├── product_id: 103\n└── alt_text\n    └── localizations\n        ├── [0]\n        │   ├── locale: &quot;en-us&quot;\n        │   └── description: &quot;red running shoe, side view.&quot;\n        ├── [1]\n        │   ├── locale: &quot;en-au&quot;\n        └── [2]\n            ├── locale: &quot;en-gb&quot;\n            └── description: &quot;red trainer, profile.&quot;\n</code></pre>\n<pre><code>ProductImages_References\n├── product_id: 103\n└── images\n    ├── primary_id: 4400\n    └── secondary_image_ids\n        ├── [0]: 4401\n        ├── [1]: 4402\n        └── [2]: 4403\n</code></pre>\n<pre><code>ProductImages_LocalizedKeywords\n├── product_id: 103\n└── alt_text\n    └── localizations\n        ├── [0]\n        │   ├── locale: &quot;en-us&quot;\n        │   └── keywords\n        │       ├── [0]: &quot;red shoe&quot;\n        │       ├── [1]: &quot;running&quot;\n        │       └── [2]: &quot;sport&quot;\n        ├── [1]\n        │   ├── locale: &quot;en-au&quot;\n        │   └── keywords\n        │       ├── [0]: &quot;red runner&quot;\n        │       └── [1]: &quot;jogging&quot;\n        └── [2]\n            ├── locale: &quot;en-gb&quot;\n            └── keywords\n                ├── [0]: &quot;trainer&quot;\n                └── [1]: &quot;athletics&quot;\n</code></pre>\n<h1 id=\"data-model\" tabindex=\"-1\">Data Model <a class=\"direct-link\" href=\"https://jacobsherin.com/posts/dremel-column-striping/#data-model\" aria-hidden=\"true\">#</a></h1>\n<p>For a moment consider a nested data model with the following restrictions:</p>\n<ol>\n<li>All fields are mandatory. There are never any null values.</li>\n<li>This model disallows list or array types, permitting only struct types and\nscalar types (includes integers, floating-point, boolean, characters and\nstrings).</li>\n</ol>\n<p>In such a model, the structure of any data instance perfectly mirrors its\nschema. Consequently, the schema alone is sufficient to reconstruct the\noriginal nested data structure from its flattened representation.</p>\n<h2 id=\"fixed-schema\" tabindex=\"-1\">Fixed Schema <a class=\"direct-link\" href=\"https://jacobsherin.com/posts/dremel-column-striping/#fixed-schema\" aria-hidden=\"true\">#</a></h2>\n<pre><code>ProductImages_Fixed_Schema\n├── product_id (u64)\n├── images\n│   └── image_id (u64)\n└── alt_text\n    ├── locale (String)\n    └── description (String)\n</code></pre>\n<pre><code>ProductImages_Fixed_1\n├── product_id: 10785\n├── images\n│   └── image_id: 55001\n└── alt_text\n    ├── locale: &quot;en-in&quot;\n    └── description: &quot;MacBook Air 13.3\\&quot; (M1 chip, 8GB RAM, 256GB SSD), Space Grey.&quot;\n</code></pre>\n<pre><code>ProductImages_Fixed_2\n├── product_id: 20488\n├── images\n│   └── image_id: 60773\n└── alt_text\n    ├── locale: &quot;en-in&quot;\n    └── description: &quot;PortaShell 13.3\\&quot; Laptop Sleeve, Grey, with pocket &amp; handle.&quot;\n</code></pre>\n<p>Here we do not have to track the presence of a field because it can never be\nnull. In this model, since all fields are mandatory and the model disallows\nlists, the cardinality of every field is therefore always one. Each field can be\neither a scalar or a struct value, never a collection. We do not have to\ndetermine if a list is empty.</p>\n<p>If both restrictions are removed then different concrete values of the same\nnested schema can have many possible structures. In these cases, one cannot\nreverse the flattened values using the schema alone.</p>\n<h2 id=\"with-optional-field\" tabindex=\"-1\">With Optional Field <a class=\"direct-link\" href=\"https://jacobsherin.com/posts/dremel-column-striping/#with-optional-field\" aria-hidden=\"true\">#</a></h2>\n<pre><code>ProductImages_Optional_Schema\n├── product_id (u64)\n├── images\n│   └── image_id (u64)\n└── alt_text\n    ├── locale (String)\n    └── description (String, optional)  // &lt;--- This field is now optional\n</code></pre>\n<pre><code>ProductImages_Optional_1\n├── product_id: 20488\n├── images\n│   └── image_id: 60773\n└── alt_text\n    ├── locale: &quot;en-in&quot;\n    // description is not present in this example\n</code></pre>\n<h2 id=\"with-list-field\" tabindex=\"-1\">With List Field <a class=\"direct-link\" href=\"https://jacobsherin.com/posts/dremel-column-striping/#with-list-field\" aria-hidden=\"true\">#</a></h2>\n<pre><code>ProductImages_List_Schema\n├── product_id (u64)\n└── images\n    ├── primary_id (u64)\n    └── secondary_image_ids (List&lt;u64&gt;)\n</code></pre>\n<pre><code>ProductImages_List_1\n├── product_id: 30501\n└── images\n    ├── primary_id: 77001\n    └── secondary_image_ids\n        ├── [0]: 77002\n        ├── [1]: 77003\n        └── [2]: 77004\n</code></pre>\n<pre><code>ProductImages_List_2\n├── product_id: 30502\n└── images\n    ├── primary_id: 77005\n    └── secondary_image_ids: [] // List is empty\n</code></pre>\n<p>This simplified model restricts our ability to express most real-world\nnested datasets because it lacks optional fields and disallows lists. But it\nhelps us narrow down the sources of structural variations.</p>\n<ol>\n<li>Is an optional field present or not?</li>\n<li>Is a list empty or not?</li>\n</ol>\n<p>Consider a data model with these restrictions removed. It allows both\noptional fields and lists - the very features that introduce structural\nvariations. Reconstructing any flattened nested data structure with a\nwell-defined schema back to its original form is indeed possible, but this\ncapability depends entirely on encoding these two structural properties\n(optional field presence and list status) as metadata.</p>\n<h1 id=\"flattening\" tabindex=\"-1\">Flattening <a class=\"direct-link\" href=\"https://jacobsherin.com/posts/dremel-column-striping/#flattening\" aria-hidden=\"true\">#</a></h1>\n<p>To flatten a nested data structure, we first enumerate its potential column\nattributes. This involves traversing the schema in depth-first order. Each\ncolumn attribute corresponds to a unique path of fields from the document's\nroot up to a leaf node. The field definition at this leaf node determines\nthe optionality and data type for that column attribute.</p>\n<ul>\n<li>[ ] <strong>TODO:</strong> Diagram enumerate paths in a schema</li>\n</ul>\n<p>Next, we traverse an actual data instance of the nested structure, again in\ndepth-first order. As we reach the leaf nodes in the data, we extract the\nscalar values and append them to the lists associated with their\ncorresponding column attributes (as identified from the schema).</p>\n<ul>\n<li>[ ] <strong>TODO:</strong> Diagram flattening nested value to column values</li>\n</ul>\n<h1 id=\"metadata:-definition-level\" tabindex=\"-1\">Metadata: Definition Level <a class=\"direct-link\" href=\"https://jacobsherin.com/posts/dremel-column-striping/#metadata:-definition-level\" aria-hidden=\"true\">#</a></h1>\n<p>A path may terminate early before it reaches the leaf node. This happens\nwhen an optional field is not present in the value tree. There is also a\npossibility that a path defined in the schema is not present in the value\ntree. Here the first field in the path is an optional field and is not\npresent in the value. This will go undetected without the schema.</p>\n<ul>\n<li>[ ] <strong>TODO:</strong> Diagram various legal constructions of terminating paths</li>\n</ul>\n<p>A path may also contain list fields which maybe empty in the value. So we\nneed to know in the case of a list field whether it is empty or contains at\nleast one element.</p>\n<p>We can track both cases by counting the optional fields which are present\nand list fields which are not empty. If an optional field is present the\ncount is incremented by one. If a list field contains at least one element\nthe count is incremented by one. Note that the count is only incremented by\none for the list field and does not depend on the number of elements in the\nlist.</p>\n<p>The terminology used by Dremel for this count metadata field is <strong>definition\nlevel</strong>. If a path contains N optional fields and list fields, then its\ndefinition level will be in the range (inclusive) [0, N]. The upper bound\ncan be derived from the schema.</p>\n<p>The definition level of a non-NULL value will always be N. For null values\nthe definition level tell us the exact point at which the path terminates.\nThis allows us to reconstruct partially terminated paths. If the definition\nlevel is 0, we know that path is entirely missing from the value.</p>\n<h1 id=\"metadata:-repetition-level\" tabindex=\"-1\">Metadata: Repetition Level <a class=\"direct-link\" href=\"https://jacobsherin.com/posts/dremel-column-striping/#metadata:-repetition-level\" aria-hidden=\"true\">#</a></h1>\n<p>A list field is variable length and maps to multiple values in a flattened\nrepresentation. Here it should be possible to determine list boundaries so\nthat the flattened values can be reverse mapped back to the correct list field.</p>\n<p>A schema path may define multiple list fields (nested lists). This poses\na serious challenge in also having to identify at which level of nesting a\nflattened value belongs.</p>\n<p>Here we need to consider only the non-empty list fields because an empty\nlist field is already handled by the definition level.</p>\n<p>Dremel uses a clever trick to encode both the list boundary and nesting\nlevel of a flattened list element into a single metadata value known as\nrepetition level.</p>\n<p>There are similarities to how definition level tracks the presence of\noptional/list fields along a path. The maximum possible repetition level for\nany value along a given schema path (let's call it R) is equal to the number\nof list fields defined in that schema path. The actual repetition level (r)\nassigned to a flattened value will then fall within the range (inclusive) [0,\nR]. If R = 2, then a flattened value can have a repetition level of 0, 1 or 2.</p>\n<p>From interpreting the repetition level of a flattened value we can identify\nthe record it belongs to and the nesting level within the record if the\nschema path defines nested lists.</p>\n<p>The rules for interpreting repetition levels are:\nIf r = 0: The value marks the beginning a new record. It is the first\noccurrence of this specific field path within that new record.\nIf r &lt; R (max repetition level for a path): This is the first element of a\nnew instance of a nested list. The value of 'r' tells us which list in the\npath (from root to leaf) this new instance belongs to.\nIf r = R: This value is a subsequent item belonging to the same instance\nof most recent list that was previously started.</p>\n<h1 id=\"metadata:-required-fields-only-path\" tabindex=\"-1\">Metadata: required fields only path <a class=\"direct-link\" href=\"https://jacobsherin.com/posts/dremel-column-striping/#metadata:-required-fields-only-path\" aria-hidden=\"true\">#</a></h1>\n<p>Consider a schema path that contains no optional fields and no list fields.\nFor any value present along such a path the definition level will always be\nzero as there are no optional or list fields. The repetition level will\nalways be zero as there are no list fields.</p>\n<p>In this specific scenario, which mirrors our simplified data model, the\nschema alone is indeed sufficient to reconstruct the data, as no structural\nvariations due to optionality or repetition exist.</p>\n<h1 id=\"putting-it-all-together\" tabindex=\"-1\">Putting it all together <a class=\"direct-link\" href=\"https://jacobsherin.com/posts/dremel-column-striping/#putting-it-all-together\" aria-hidden=\"true\">#</a></h1>\n<p>Let us now see how this works in practice.</p>\n<h2 id=\"schema\" tabindex=\"-1\">Schema <a class=\"direct-link\" href=\"https://jacobsherin.com/posts/dremel-column-striping/#schema\" aria-hidden=\"true\">#</a></h2>\n<pre><code>ProductImages (doc)\n|- product_id (u64)\n|- images\n|  |- primary_id (u64)\n|  |- secondary_image_ids (list u64)\n|- alt_text\n   |- localizations (list)\n      |- locale (string)\n      |- description (optional string)\n      |- keywords (list string)\n</code></pre>\n<p>This schema represents a nested data structure which contains references to\nthe display images belonging to a product. It also provides zero or more\nlocalized alt text entries for internationalization (i18n). Each entry has a\nlocale, description (the alt text itself), and keywords (for seo).</p>\n<p>The individual attributes present in this schema are:</p>\n<table>\n<thead>\n<tr>\n<th>No.</th>\n<th>Schema Path</th>\n<th>Data Type</th>\n<th>Optional</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>product_id</td>\n<td>u64</td>\n<td>N</td>\n</tr>\n<tr>\n<td>2</td>\n<td>images.primary_id</td>\n<td>u64</td>\n<td>N</td>\n</tr>\n<tr>\n<td>3</td>\n<td>images.secondary_image_ids</td>\n<td>u64</td>\n<td>N</td>\n</tr>\n<tr>\n<td>4</td>\n<td>alt_text.localizations.locale</td>\n<td>string</td>\n<td>N</td>\n</tr>\n<tr>\n<td>5</td>\n<td>alt_text.localizations.description</td>\n<td>string</td>\n<td>Y</td>\n</tr>\n<tr>\n<td>6</td>\n<td>alt_text.localizations.keywords</td>\n<td>string</td>\n<td>N</td>\n</tr>\n</tbody>\n</table>\n<p>Each path in our schema has a maximum possible definition level (D) and\nrepetition level (R). The maximum D is calculated by counting how many\nfields along the path are either optional or list types. The maximum R is\nthe count of just the list type fields along the path. For our ProductImages\nschema, these maximums are:</p>\n<table>\n<thead>\n<tr>\n<th>No.</th>\n<th>Schema Path</th>\n<th>D</th>\n<th>R</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>product_id</td>\n<td>0</td>\n<td>0</td>\n</tr>\n<tr>\n<td>2</td>\n<td>images.primary_id</td>\n<td>0</td>\n<td>0</td>\n</tr>\n<tr>\n<td>3</td>\n<td>images.secondary_image_ids</td>\n<td>1</td>\n<td>1</td>\n</tr>\n<tr>\n<td>4</td>\n<td>alt_text.localizations.locale</td>\n<td>1</td>\n<td>1</td>\n</tr>\n<tr>\n<td>5</td>\n<td>alt_text.localizations.description</td>\n<td>2</td>\n<td>1</td>\n</tr>\n<tr>\n<td>6</td>\n<td>alt_text.localizations.keywords</td>\n<td>2</td>\n<td>2</td>\n</tr>\n</tbody>\n</table>\n<p>D - Definition Level\nR - Repetition Level</p>\n<h3 id=\"document-1-(d1)\" tabindex=\"-1\">document 1 (D1) <a class=\"direct-link\" href=\"https://jacobsherin.com/posts/dremel-column-striping/#document-1-(d1)\" aria-hidden=\"true\">#</a></h3>\n<p>Multiple holes are present in this document. the secondary images list is\nempty. the single localization which is present does not have any keywords\ndefined yet.</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">product_id</span><span class=\"token punctuation\">:</span> <span class=\"token number\">101</span><br /><span class=\"token key atrule\">images</span><span class=\"token punctuation\">:</span><br />  <span class=\"token key atrule\">primary_id</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2001</span><br />  <span class=\"token key atrule\">secondary_image_ids</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token punctuation\">]</span><br /><span class=\"token key atrule\">alt_text</span><span class=\"token punctuation\">:</span><br />  <span class=\"token key atrule\">localizations</span><span class=\"token punctuation\">:</span><br />    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">locale</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"en-us\"</span><br />      <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"blue casual t-shirt.\"</span><br />      <span class=\"token key atrule\">keywords</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token punctuation\">]</span></code></pre>\n<h3 id=\"document-2-(d2)\" tabindex=\"-1\">document 2 (D2) <a class=\"direct-link\" href=\"https://jacobsherin.com/posts/dremel-column-striping/#document-2-(d2)\" aria-hidden=\"true\">#</a></h3>\n<p>This document contains only the product id and primary image id. the\nremaining properties are either missing or empty.</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">product_id</span><span class=\"token punctuation\">:</span> <span class=\"token number\">102</span><br /><span class=\"token key atrule\">images</span><span class=\"token punctuation\">:</span><br />  <span class=\"token key atrule\">primary_id</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3010</span><br />  <span class=\"token key atrule\">secondary_image_ids</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token punctuation\">]</span><br /><span class=\"token key atrule\">alt_text</span><span class=\"token punctuation\">:</span><br />  <span class=\"token key atrule\">localizations</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token punctuation\">]</span></code></pre>\n<h3 id=\"document-3-(d3)\" tabindex=\"-1\">document 3 (D3) <a class=\"direct-link\" href=\"https://jacobsherin.com/posts/dremel-column-striping/#document-3-(d3)\" aria-hidden=\"true\">#</a></h3>\n<p>This is a fairly complete document with multiple secondary image ids and\nmultiple localizations with varied content.</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">product_id</span><span class=\"token punctuation\">:</span> <span class=\"token number\">103</span><br /><span class=\"token key atrule\">images</span><span class=\"token punctuation\">:</span><br />  <span class=\"token key atrule\">primary_id</span><span class=\"token punctuation\">:</span> <span class=\"token number\">4400</span><br />  <span class=\"token key atrule\">secondary_image_ids</span><span class=\"token punctuation\">:</span><br />    <span class=\"token punctuation\">-</span> <span class=\"token number\">4401</span><br />    <span class=\"token punctuation\">-</span> <span class=\"token number\">4402</span><br />    <span class=\"token punctuation\">-</span> <span class=\"token number\">4403</span><br /><span class=\"token key atrule\">alt_text</span><span class=\"token punctuation\">:</span><br />  <span class=\"token key atrule\">localizations</span><span class=\"token punctuation\">:</span><br />    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">locale</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"en-us\"</span><br />      <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"red running shoe, side view.\"</span><br />      <span class=\"token key atrule\">keywords</span><span class=\"token punctuation\">:</span><br />        <span class=\"token punctuation\">-</span> <span class=\"token string\">\"red shoe\"</span><br />        <span class=\"token punctuation\">-</span> <span class=\"token string\">\"running\"</span><br />        <span class=\"token punctuation\">-</span> <span class=\"token string\">\"sport\"</span><br />    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">locale</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"en-au\"</span><br />      <span class=\"token comment\"># placeholder locale does not yet have a description</span><br />      <span class=\"token key atrule\">keywords</span><span class=\"token punctuation\">:</span><br />        <span class=\"token punctuation\">-</span> <span class=\"token string\">\"red runner\"</span><br />        <span class=\"token punctuation\">-</span> <span class=\"token string\">\"jogging\"</span><br />    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">locale</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"en-gb\"</span><br />      <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"red trainer, profile.\"</span><br />      <span class=\"token key atrule\">keywords</span><span class=\"token punctuation\">:</span><br />        <span class=\"token punctuation\">-</span> <span class=\"token string\">\"trainer\"</span><br />        <span class=\"token punctuation\">-</span> <span class=\"token string\">\"athletics\"</span></code></pre>\n<p>After flattening the documents, the values in each path are stored contiguously.</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">product_id</span><span class=\"token punctuation\">:</span><br />  <span class=\"token key atrule\">values</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">101</span><span class=\"token punctuation\">,</span> <span class=\"token number\">102</span><span class=\"token punctuation\">,</span> <span class=\"token number\">103</span> <span class=\"token punctuation\">]</span><br />  <span class=\"token key atrule\">def</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span><br />  <span class=\"token key atrule\">rep</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span><br /><br /><span class=\"token key atrule\">images.primary_id</span><span class=\"token punctuation\">:</span><br />  <span class=\"token key atrule\">values</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">2001</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3010</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4400</span> <span class=\"token punctuation\">]</span><br />  <span class=\"token key atrule\">def</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span><br />  <span class=\"token key atrule\">rep</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span></code></pre>\n<p>The paths product_id and images.primary_id contain only mandatory fields. So\nthe derived definition and repetition level values is going to be zero for\nall values. So it is equivalent to the following storage representation.</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">product_id</span><span class=\"token punctuation\">:</span><br />  <span class=\"token key atrule\">values</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">101</span><span class=\"token punctuation\">,</span> <span class=\"token number\">102</span><span class=\"token punctuation\">,</span> <span class=\"token number\">103</span> <span class=\"token punctuation\">]</span><br /><br /><span class=\"token key atrule\">images.primary_id</span><span class=\"token punctuation\">:</span><br />  <span class=\"token key atrule\">values</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">2001</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3010</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4400</span> <span class=\"token punctuation\">]</span></code></pre>\n<h2 id=\"path:-images.secondary_image_ids\" tabindex=\"-1\">Path: images.secondary_image_ids <a class=\"direct-link\" href=\"https://jacobsherin.com/posts/dremel-column-striping/#path:-images.secondary_image_ids\" aria-hidden=\"true\">#</a></h2>\n<p>Step 1: Flatten D1</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">images.secondary_image_ids</span><span class=\"token punctuation\">:</span><br />  <span class=\"token key atrule\">values</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token null important\">NULL</span> <span class=\"token punctuation\">]</span><br />  <span class=\"token key atrule\">def</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span><br />  <span class=\"token key atrule\">rep</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span></code></pre>\n<p>The definition level is zero because secondary_image_ids list is empty. The\nrepetition level is zero here for the same reason. The repetition level for\nthe path images.secondary_image_ids is in the range (inclusive) [0, 1]. Here\nthe interpretation of zero is not that this is the first element in the list,\nwhich is not possible as the list is empty. But we have to read it together\nwith the NULL value and the definition level value which happens to be zero\nand signals that the list is empty.</p>\n<p>Step 2: Flatten D2</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">images.secondary_image_ids</span><span class=\"token punctuation\">:</span><br />  <span class=\"token key atrule\">values</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token null important\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token null important\">NULL</span> <span class=\"token punctuation\">]</span><br />  <span class=\"token key atrule\">def</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span><br />  <span class=\"token key atrule\">rep</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span></code></pre>\n<p>The same reasoning as above applies here.</p>\n<p>Step 3: Flatten D3</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">images.secondary_image_ids</span><span class=\"token punctuation\">:</span><br />  <span class=\"token key atrule\">values</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token null important\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token null important\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4401</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4402</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4403</span> <span class=\"token punctuation\">]</span><br />  <span class=\"token key atrule\">def</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">]</span><br />  <span class=\"token key atrule\">rep</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">]</span></code></pre>\n<p>As the list is not empty, the definition level for all values in this list\nis 1. The repetition level for the first element 4401 is zero, and for\nsubsequent elements the repetition level is one. This marks 4401 as the\nbeginning of a new list instance in a new document.</p>\n<h2 id=\"path-4:-alt_text.localizations.locale\" tabindex=\"-1\">Path 4: alt_text.localizations.locale <a class=\"direct-link\" href=\"https://jacobsherin.com/posts/dremel-column-striping/#path-4:-alt_text.localizations.locale\" aria-hidden=\"true\">#</a></h2>\n<p>The struct alt_text is required/mandatory and locale is a required/mandatory\nstring. The localizations is a list. So this has a maximum definition level\nof 1 and maximum repetition levels is also 1.</p>\n<p>The inner data type of localizations is a struct with three properties:</p>\n<ul>\n<li>locale: a required/mandatory string</li>\n<li>description: an optional string</li>\n<li>keywords: a list of strings</li>\n</ul>\n<p>Step 1: Flatten D1</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">alt_text.localizations.locale</span><span class=\"token punctuation\">:</span><br />  <span class=\"token key atrule\">values</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"en-us\"</span> <span class=\"token punctuation\">]</span><br />  <span class=\"token key atrule\">def</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">]</span><br />  <span class=\"token key atrule\">rep</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span></code></pre>\n<p>In D1 a single locale is defined. So the derived definition level is 1\nbecause the localizations list is present. The repetition level is 0 which\nindicates that this is the first occurrence of the locale struct property in\na new instance of the localizations list in a new document.</p>\n<p>Step 2: Flatten D2</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">alt_text.localizations.locale</span><span class=\"token punctuation\">:</span><br />  <span class=\"token key atrule\">values</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"en-us\"</span><span class=\"token punctuation\">,</span> <span class=\"token null important\">NULL</span> <span class=\"token punctuation\">]</span><br />  <span class=\"token key atrule\">def</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span><br />  <span class=\"token key atrule\">rep</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span></code></pre>\n<p>In D2 the localizations list is empty. So the definition level becomes 0 and\nNULL value is inserted. The repetition level is zero, but has to interpreted\ntogether with the NULL value and definition level which shows that the\nlocalizations list is empty in this document.</p>\n<p>Step 3: Flatten D3</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">alt_text.localizations.locale</span><span class=\"token punctuation\">:</span><br />  <span class=\"token key atrule\">values</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"en-us\"</span><span class=\"token punctuation\">,</span> <span class=\"token null important\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"en-us\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"en-au\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"en-gb\"</span> <span class=\"token punctuation\">]</span><br />  <span class=\"token key atrule\">def</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">]</span><br />  <span class=\"token key atrule\">rep</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">]</span></code></pre>\n<p>There are three locale values in D3. They are added to values. The\ndefinition level is 1 because the localizations is not empty. The\nrepetition level is 0 for &quot;en-us&quot; which signals that this is the beginning\nof a new localizations list instance in a new document and this is the\nfirst element. The subsequent elements in the list therefore have the\nrepetition level of 1.</p>\n<h2 id=\"path-5:-alt_text.localizations.description\" tabindex=\"-1\">Path 5: alt_text.localizations.description <a class=\"direct-link\" href=\"https://jacobsherin.com/posts/dremel-column-striping/#path-5:-alt_text.localizations.description\" aria-hidden=\"true\">#</a></h2>\n<p>In this path localizations is a list and description is an optional string.\nSo the maximum definition level is 2. The maximum value for repetition level\nis 1 as there is only a single list in this path.</p>\n<p>Step 1: Flatten D1</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">alt_text.localizations.description</span><span class=\"token punctuation\">:</span><br />  <span class=\"token key atrule\">values</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"blue casual t-shirt\"</span> <span class=\"token punctuation\">]</span><br />  <span class=\"token key atrule\">def</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">]</span><br />  <span class=\"token key atrule\">rep</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span></code></pre>\n<p>The optional description is present in D1. So the definition level is 2, and\nthe repetition level is 0. This is the first description in a new instance\nof localizations, at the start of the document.</p>\n<p>Step 2: Flatten D2</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">alt_text.localizations.description</span><span class=\"token punctuation\">:</span><br />  <span class=\"token key atrule\">values</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"blue casual t-shirt\"</span><span class=\"token punctuation\">,</span> <span class=\"token null important\">NULL</span> <span class=\"token punctuation\">]</span><br />  <span class=\"token key atrule\">def</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">]</span><br />  <span class=\"token key atrule\">rep</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span></code></pre>\n<p>In D2, the localizations list is empty. A NULL value is inserted for\ndescription. The definition level is 1 indicating that the path is defined\nup to the localizations list field, but the list is empty so no actual\ndescription value exists within a list item. The repetition level is 0, as\nthe entry corresponds to a new record (D2).</p>\n<p>Step 3: Flatten D3</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">alt_text.localizations.description</span><span class=\"token punctuation\">:</span><br />  <span class=\"token key atrule\">values</span><span class=\"token punctuation\">:</span><br />    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"blue casual t-shirt\"</span>         <span class=\"token comment\"># D1</span><br />    <span class=\"token punctuation\">-</span> <span class=\"token null important\">NULL</span>                          <span class=\"token comment\"># D2</span><br />    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"red running shoe, side view\"</span> <span class=\"token comment\"># D3</span><br />    <span class=\"token punctuation\">-</span> <span class=\"token null important\">NULL</span>                          <span class=\"token comment\"># D3</span><br />    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"red trainer, profile\"</span>        <span class=\"token comment\"># D3</span><br />  <span class=\"token key atrule\">def</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">]</span><br />  <span class=\"token key atrule\">rep</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">]</span></code></pre>\n<p>The second description is not present, so a NULL value is inserted in its\nplace and its definition level is 1. The first description and third\ndescription are present, so they have a definition level of 2. The\nrepetition level of the first description is 0 to indicate that this is a\nnew instance of a localizations list, and this is the first description\nproperty in the first struct element. The subsequent descriptions have a\nrepetition level of 1 to indicate that they are elements belonging to this same\nlist.</p>\n<h2 id=\"path-6:-alt_text.localizations.keywords\" tabindex=\"-1\">Path 6: alt_text.localizations.keywords <a class=\"direct-link\" href=\"https://jacobsherin.com/posts/dremel-column-striping/#path-6:-alt_text.localizations.keywords\" aria-hidden=\"true\">#</a></h2>\n<p>This is the first time we encounter a nested list. Both localizations and\nkeywords are list fields. The maximum definition level is 2 and the maximum\nrepetition level is also 2 for this path.</p>\n<p>Step 1: Flatten D1</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">alt_text</span><span class=\"token punctuation\">:</span><br />  <span class=\"token key atrule\">localizations</span><span class=\"token punctuation\">:</span><br />    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">locale</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"en-us\"</span><br />      <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"blue casual t-shirt.\"</span><br />      <span class=\"token key atrule\">keywords</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token punctuation\">]</span></code></pre>\n<p>In D1, keywords list is present, but it is empty.</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">alt_text.localizations.keywords</span><span class=\"token punctuation\">:</span><br />  <span class=\"token key atrule\">values</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token null important\">NULL</span> <span class=\"token punctuation\">]</span><br />  <span class=\"token key atrule\">def</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">]</span><br />  <span class=\"token key atrule\">rep</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span></code></pre>\n<p>We insert a NULL value because keywords list is empty. The definition level\nis 1 as localizations list is present and not empty, but the keywords list\nis empty. The repetition level is zero because this is the start of a new\nrecord (D1).</p>\n<p>Step 2: Flatten D2</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">alt_text</span><span class=\"token punctuation\">:</span><br />  <span class=\"token key atrule\">localizations</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token punctuation\">]</span></code></pre>\n<p>In D2, the localizations list is empty.</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">alt_text.localizations.keywords</span><span class=\"token punctuation\">:</span><br />  <span class=\"token key atrule\">values</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token null important\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token null important\">NULL</span> <span class=\"token punctuation\">]</span><br />  <span class=\"token key atrule\">def</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span><br />  <span class=\"token key atrule\">rep</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span></code></pre>\n<p>The definition level in this case is 0 because the localizations list is\nempty. The repetition level is 0 because this is the start of a new record (D2).</p>\n<p>Step 3: Flatten D3</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">alt_text</span><span class=\"token punctuation\">:</span><br />  <span class=\"token key atrule\">localizations</span><span class=\"token punctuation\">:</span><br />    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">locale</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"en-us\"</span><br />      <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"red running shoe, side view.\"</span><br />      <span class=\"token key atrule\">keywords</span><span class=\"token punctuation\">:</span><br />        <span class=\"token punctuation\">-</span> <span class=\"token string\">\"red shoe\"</span><br />        <span class=\"token punctuation\">-</span> <span class=\"token string\">\"running\"</span><br />        <span class=\"token punctuation\">-</span> <span class=\"token string\">\"sport\"</span><br />    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">locale</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"en-au\"</span><br />      <span class=\"token comment\"># placeholder locale does not yet have a description</span><br />      <span class=\"token key atrule\">keywords</span><span class=\"token punctuation\">:</span><br />        <span class=\"token punctuation\">-</span> <span class=\"token string\">\"red runner\"</span><br />        <span class=\"token punctuation\">-</span> <span class=\"token string\">\"jogging\"</span><br />    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">locale</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"en-gb\"</span><br />      <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"red trainer, profile.\"</span><br />      <span class=\"token key atrule\">keywords</span><span class=\"token punctuation\">:</span><br />        <span class=\"token punctuation\">-</span> <span class=\"token string\">\"trainer\"</span><br />        <span class=\"token punctuation\">-</span> <span class=\"token string\">\"athletics\"</span></code></pre>\n<p>The localizations list contains 3 items. So let us break this up by item so\nwe can clearly see how repetition levels varies across keywords for each item.</p>\n<p>After processing the first item in localizations:</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">alt_text.localizations.keywords</span><span class=\"token punctuation\">:</span><br />  <span class=\"token key atrule\">values</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"red shoe\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"running\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"sport\"</span> <span class=\"token punctuation\">]</span><br />  <span class=\"token key atrule\">def</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">]</span><br />  <span class=\"token key atrule\">rep</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">]</span></code></pre>\n<p>The localizations list is present and the keywords list is present, and both\nare not empty. So the definition level is 2. The first item in the list has\na repetition level of 0 because this is the beginning of a new record (D3).\nThe other items have a repetition level of 2 to indicate that this is a\ncontinuation of the current keywords list.</p>\n<p>Now the second item,</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">alt_text.localizations.keywords</span><span class=\"token punctuation\">:</span><br />  <span class=\"token key atrule\">values</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"red runner\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"jogging\"</span> <span class=\"token punctuation\">]</span><br />  <span class=\"token key atrule\">def</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">]</span><br />  <span class=\"token key atrule\">rep</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">]</span></code></pre>\n<p>The definition level is 2 as both lists in the path are present. Note that\nthe repetition level for &quot;red runner&quot; is not zero. This is significant! This\nkeywords field is part of the second struct item in localizations. And\nlocalizations has a repetition level in the range (inclusive) [0, 1]. The 0\nrepetition level marks the beginning of a new record, but here this is the\nsecond item in the localizations list. The computed repetition level is\ntherefore 1 for all remaining structs in this list. Now when we reach the\nkeywords list, this is a new list instance and &quot;red runner&quot; is the first\nelement in the list. So the repetition level for &quot;red runner&quot; is 1. The\nremaining items in the list have a repetition level of 2 to indicate that it\nis a continuation of the newly opened list.</p>\n<p>And the final item in localizations,</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">alt_text.localizations.keywords</span><span class=\"token punctuation\">:</span><br />  <span class=\"token key atrule\">values</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"trainer\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"athletics\"</span> <span class=\"token punctuation\">]</span><br />  <span class=\"token key atrule\">def</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">]</span><br />  <span class=\"token key atrule\">rep</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">]</span></code></pre>\n<p>The repetition level of &quot;trainer&quot; is 1 because it is child property of the\nthird struct item in localizations list. The repetition level for the third\nitem can only be 1. Also, &quot;trainer&quot; is the first item in the new instance of\nkeywords list so we give it a repetition level of 1 to identify it as the\nfirst element in a new keywords list. The remaining items in keywords get a\nrepetition level of 2.</p>\n<p>The final aggregation of keywords after processing D1, D2 and all three\nlocalization items from D3:</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">alt_text.localizations.keywords</span><span class=\"token punctuation\">:</span><br />  <span class=\"token key atrule\">values</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><br />    <span class=\"token null important\">NULL</span><span class=\"token punctuation\">,</span>                           <span class=\"token comment\"># D1: keywords list is empty</span><br />    NULL<span class=\"token punctuation\">,</span>                           <span class=\"token comment\"># D2: localizations list is empty</span><br />    \"red shoe\"<span class=\"token punctuation\">,</span> <span class=\"token string\">\"running\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"sport\"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\"># D3: 1st localization (\"en-us\")</span><br />    \"red runner\"<span class=\"token punctuation\">,</span> <span class=\"token string\">\"jogging\"</span><span class=\"token punctuation\">,</span>        <span class=\"token comment\"># D3: 2nd localization (\"en-au\")</span><br />    \"trainer\"<span class=\"token punctuation\">,</span> <span class=\"token string\">\"athletics\"</span>          <span class=\"token comment\"># D3: 3rd localization (\"en-gb\")</span><br />  <span class=\"token punctuation\">]</span><br />  <span class=\"token key atrule\">def</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><br />    <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>        <span class=\"token comment\"># D1: (localizations present, keywords empty)</span><br />    0<span class=\"token punctuation\">,</span>        <span class=\"token comment\"># D2: (localizations empty)</span><br />    2<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># D3: (both list present and non-empty)</span><br />    2<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span><br />    <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><br />  <span class=\"token punctuation\">]</span><br />  <span class=\"token key atrule\">rep</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><br />    <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>        <span class=\"token comment\"># D1: new record</span><br />    0<span class=\"token punctuation\">,</span>        <span class=\"token comment\"># D2: new record</span><br />    0<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># D3: 1st localization: r=0 for first keyword, r=2 for remaining</span><br />    1<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>     <span class=\"token comment\"># D3: 2nd localization: r=1 for first keyword, r=2 for remaining</span><br />    1<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span>      <span class=\"token comment\"># D3: 3rd localization: r=1 for first keyword, r=2 for remaining</span><br />  <span class=\"token punctuation\">]</span></code></pre>\n<h1 id=\"conclusion\" tabindex=\"-1\">Conclusion <a class=\"direct-link\" href=\"https://jacobsherin.com/posts/dremel-column-striping/#conclusion\" aria-hidden=\"true\">#</a></h1>\n<ul>\n<li>[ ] TODO</li>\n</ul>\n",
      "date_published": "2025-04-21T00:00:00Z"
    },{
      "id": "https://jacobsherin.com/posts/fourthpost/",
      "url": "https://jacobsherin.com/posts/fourthpost/",
      "title": "This is my fourth post.",
      "content_html": "<p>Leverage agile frameworks to provide a robust synopsis for high level overviews. Iterative approaches to corporate strategy foster collaborative thinking to further the overall value proposition. Organically grow the holistic world view of disruptive innovation via workplace diversity and empowerment.</p>\n<p>Bring to the table win-win survival strategies to ensure proactive domination. At the end of the day, going forward, a new normal that has evolved from generation X is on the runway heading towards a streamlined cloud solution. User generated content in real-time will have multiple touchpoints for offshoring.</p>\n<h2 id=\"section-header\" tabindex=\"-1\">Section Header <a class=\"direct-link\" href=\"https://jacobsherin.com/posts/fourthpost/#section-header\" aria-hidden=\"true\">#</a></h2>\n<p>Capitalize on low hanging fruit to identify a ballpark value added activity to beta test. Override the digital divide with additional clickthroughs from DevOps. Nanotechnology immersion along the information highway will close the loop on focusing solely on the bottom line.</p>\n",
      "date_published": "2018-09-30T00:00:00Z"
    },{
      "id": "https://jacobsherin.com/posts/thirdpost/",
      "url": "https://jacobsherin.com/posts/thirdpost/",
      "title": "This is my third post.",
      "content_html": "<p>Leverage agile frameworks to provide a robust synopsis for high level overviews. Iterative approaches to corporate strategy foster collaborative thinking to further the overall value proposition. Organically grow the holistic world view of disruptive innovation via workplace diversity and empowerment.</p>\n<pre class=\"language-diff-js\"><code class=\"language-diff-js\">// this is a command<br />function myCommand() {<br /><span class=\"token inserted-sign inserted language-js\"><span class=\"token prefix inserted\">+</span>\t<span class=\"token keyword\">let</span> counter <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span><br /></span><br /><span class=\"token deleted-sign deleted language-js\"><span class=\"token prefix deleted\">-</span>\tcounter<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span><br /></span><br />}<br /><br />// Test with a line break above this line.<br />console.log('Test');</code></pre>\n<p>Bring to the table win-win survival strategies to ensure proactive domination. At the end of the day, going forward, a new normal that has evolved from generation X is on the runway heading towards a streamlined cloud solution. User generated content in real-time will have multiple touchpoints for offshoring.</p>\n<h2 id=\"section-header\" tabindex=\"-1\">Section Header <a class=\"direct-link\" href=\"https://jacobsherin.com/posts/thirdpost/#section-header\" aria-hidden=\"true\">#</a></h2>\n<p>Capitalize on low hanging fruit to identify a ballpark value added activity to beta test. Override the digital divide with additional clickthroughs from DevOps. Nanotechnology immersion along the information highway will close the loop on focusing solely on the bottom line.</p>\n",
      "date_published": "2018-08-24T00:00:00Z"
    },{
      "id": "https://jacobsherin.com/posts/secondpost/",
      "url": "https://jacobsherin.com/posts/secondpost/",
      "title": "This is my second post.",
      "content_html": "<p>Leverage agile frameworks to provide a robust synopsis for high level overviews. Iterative approaches to corporate strategy foster collaborative thinking to further the overall value proposition. Organically grow the holistic world view of disruptive innovation via workplace diversity and empowerment.</p>\n<h2 id=\"section-header\" tabindex=\"-1\">Section Header <a class=\"direct-link\" href=\"https://jacobsherin.com/posts/secondpost/#section-header\" aria-hidden=\"true\">#</a></h2>\n<p><a href=\"https://jacobsherin.com/posts/firstpost/\">First post</a>\n<a href=\"https://jacobsherin.com/posts/thirdpost/\">Third post</a></p>\n<p>Bring to the table win-win survival strategies to ensure proactive domination. At the end of the day, going forward, a new normal that has evolved from generation X is on the runway heading towards a streamlined cloud solution. User generated content in real-time will have multiple touchpoints for offshoring.</p>\n<p>Capitalize on low hanging fruit to identify a ballpark value added activity to beta test. Override the digital divide with additional clickthroughs from DevOps. Nanotechnology immersion along the information highway will close the loop on focusing solely on the bottom line.</p>\n",
      "date_published": "2018-07-04T00:00:00Z"
    },{
      "id": "https://jacobsherin.com/posts/firstpost/",
      "url": "https://jacobsherin.com/posts/firstpost/",
      "title": "This is my first post.",
      "content_html": "<p>Leverage agile frameworks to provide a robust synopsis for high level overviews. Iterative approaches to corporate strategy foster collaborative thinking to further the overall value proposition. Organically grow the holistic world view of disruptive innovation via workplace diversity and empowerment.</p>\n<p>Bring to the table win-win survival strategies to ensure proactive domination. At the end of the day, going forward, a new normal that has evolved from generation X is on the runway heading towards a streamlined cloud solution. User generated content in real-time will have multiple touchpoints for offshoring.</p>\n<h2 id=\"section-header\" tabindex=\"-1\">Section Header <a class=\"direct-link\" href=\"https://jacobsherin.com/posts/firstpost/#section-header\" aria-hidden=\"true\">#</a></h2>\n<p>Capitalize on low hanging fruit to identify a ballpark value added activity to beta test. Override the digital divide with additional clickthroughs from DevOps. Nanotechnology immersion along the information highway will close the loop on focusing solely on the bottom line.</p>\n<pre class=\"language-diff-js\"><code class=\"language-diff-js\">// this is a command<br />function myCommand() {<br /><span class=\"token inserted-sign inserted language-js\"><span class=\"token prefix inserted\">+</span>\t<span class=\"token keyword\">let</span> counter <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span><br /><span class=\"token prefix inserted\">+</span>\tcounter<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span><br /></span>}<br /><br />// Test with a line break above this line.<br />console.log('Test');</code></pre>\n",
      "date_published": "2018-05-01T00:00:00Z"
    }
  ]
}
